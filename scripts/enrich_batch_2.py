#!/usr/bin/env python3
"""
自动补充缺失书籍信息 - 第二批 (经典名著与高分书籍)
"""

import re
from pathlib import Path

book_info = {
    # --- 修复作者介绍 ---
    "江户时代江户城": {
        "authorDetail": "（日）内藤昌，日本建筑史学家，工学博士。曾任千叶大学工学部教授，专门从事日本近世建筑史和都市史的研究。"
    },
    
    # --- 丰富简介 (原 < 100 字) ---
    "动物农场": {
        "description": "《动物农场》是奥威尔最著名的反乌托邦寓言小说之一。农场的一群动物成功进行了一场“革命”，将压榨他们的人类东家赶出农场，建立起一个平等的动物社会。然而，动物领袖——猪，最终却通过权术篡夺了革命果实，成为比人类更加独裁和极权的统治者。“所有动物一律平等，但有些动物比其他动物更平等”成为极权主义的讽刺写照。"
    },
    "房思琪的初恋乐园": {
        "description": "令人心碎却无能为力的真实故事，向死而生的文学绝唱。小说讲述了美丽的文学少女房思琪被补习班老师李国华长期性侵，最终精神崩溃的故事。作者林奕含用极度精准且华丽的文字，撕开了“性、权力、升学主义”背后的丑陋真相，探讨了权势性侵、家庭暴力以及社会对受害者的二次伤害，是对现代社会痛彻心扉的控诉。"
    },
    "撒哈拉的故事": {
        "description": "《撒哈拉的故事》是三毛脍炙人口的散文集，记录了她与丈夫荷西在撒哈拉沙漠生活的奇闻逸事。在贫瘠荒凉的沙漠中，三毛用她奇特的好奇心和艺术家的生活情趣，将棺材板做成家具，用指甲油给邻居治病，参加沙漠婚礼……字里行间洋溢着对生活的热爱和对自由的追求，感动了无数读者。"
    },
    "失踪的孩子": {
        "description": "“那不勒斯四部曲”的终章。莉拉和埃莱娜步入壮年，经历了结婚、生子、离异、事业起伏和情感纠葛。她们必须面对生活带来的沉重打击：莉拉的孩子离奇失踪，彻底击垮了她；埃莱娜则在名利场中挣扎。小说跨越半个世纪，通过两个女人的命运，展现了意大利社会的变迁以及女性友谊的复杂与深沉。"
    },
    "新名字的故事": {
        "description": "“那不勒斯四部曲”第二部。莉拉和埃莱娜的青年时代充满了动荡。莉拉在不幸的婚姻中遭受折磨，试图通过婚外情寻找解脱；埃莱娜则通过求学努力逃离那不勒斯的贫困与暴力，却始终无法摆脱莉拉阴影的影响。两人在痛苦、嫉妒、竞争与依赖中共同成长，探索着身为女性的命运与可能。"
    },
    "野草": {
        "description": "《野草》是鲁迅先生唯一的一部散文诗集，被誉为中国现代文学史上的瑰宝。收录了他在1924年至1926年间创作的23篇作品。鲁迅以独特的象征主义手法和深邃的哲学思考，描绘了内心的黑暗、虚无与绝望，以及在绝望中坚持抗争的“反抗绝望”精神。如《影的告别》、《死火》、《墓碣文》等，意象奇特，语言凝练冷峻。"
    },
    "沉默的大多数": {
        "description": "王小波杂文随笔集的代表作。在书中，王小波以幽默、理性和自由的笔触，对中国社会的传统文化、道德伦理、知识分子命运以及生活中的荒谬现象进行了深刻的剖析与反思。他主张思维的乐趣，反对愚蠢和盲从，以此书为那些在历史和现实中“沉默的大多数”发声，启迪了无数青年的独立思考意识。"
    },
    "罗杰疑案": {
        "description": "侦探小说女王阿加莎·克里斯蒂的成名作，也是推理文学史上最具争议和开创性的作品之一。故事讲述了住在金艾博特村的富翁罗杰·艾克罗伊德在书房被刺身亡。刚退休在此隐居的大侦探波洛介入调查，剥茧抽丝。结局的真相完全颠覆了读者的认知，开创了“叙述性诡计”的先河，被誉为不可复制的经典。"
    },
    "悉达多": {
        "description": "诺贝尔文学奖得主赫尔曼·黑塞的代表作。小说讲述了古印度贵族青年悉达多，为了追求心灵的安宁和生命的真谛，毅然放弃优越生活，离家出走。他做过苦行僧，当过富商，沉沦于情欲和名利，最终在河边聆听流水的声音，彻悟了万物统一的哲理。这是一部关于自我发现、精神成长和生命圆融的智慧之书。"
    },
    "我与地坛": {
        "description": "史铁生的散文代表作，也是中国当代文学中最动人的篇章之一。作者在最狂妄的年纪双腿残疾，在绝望中他日复一日地进入地坛古园沉思。地坛的沧桑与宁静抚慰了他躁动的心魂。书中记录了他对母亲深切的怀念，对生命、死亡、苦难与信仰的终极思考。文字深沉凝重，充满了对人生的悲悯与大爱。"
    },
    "许三观卖血记": {
        "description": "余华的经典长篇小说。讲述了丝厂送茧工许三观靠卖血度过人生一个个难关的故事。每次面临家庭危机——娶亲、救治重病的儿子、招待特殊的客人，许三观都不得不去卖血。虽然生活充满了苦难和荒诞，但许三观始终保持着底层小人物的善良、乐观与顽强。小说以卖血为主线，淋漓尽致地展现了中国百姓的生存智慧和温情。"
    },
    "彷徨": {
        "description": "鲁迅的第二部小说集，收录了《祝福》、《在酒楼上》、《伤逝》、《肥皂》等经典名篇。作品创作于五四运动落潮期，反映了当时知识分子在旧制度崩溃和新社会尚未到来时的苦闷、彷徨与探索。鲁迅以更加圆熟深沉的笔触，刻画了祥林嫂、吕纬甫、涓生等人物形象，揭示了封建礼教“吃人”的本质和人性的复杂。"
    },
    "局外人": {
        "description": "加缪的存在主义文学代表作，诺贝尔文学奖得奖理由之一。小说塑造了默尔索这个惊世骇俗的“局外人”形象。他对母亲的去世无动于衷，对女友的感情冷漠淡然，甚至在海滩上莫名其妙地枪杀了一个阿拉伯人。在法庭上，他因为“不合常规”的冷漠态度被判处死刑。小说深刻揭示了世界的荒诞性以及个人与社会规则的对立。"
    },
    "白鹿原": {
        "description": "陈忠实的传世之作，茅盾文学奖获奖作品。小说以陕西关中平原上的白鹿村为背景，描写了白姓和鹿姓两大家族祖孙三代的恩怨纠葛。时间跨度从清末民初到建国之初，展现了中国农村在半个世纪里的历史变迁。书中融入了关中风情、儒家文化、革命斗争等丰富元素，是一部厚重深沉的民族秘史。"
    },
    "乡土中国": {
        "description": "费孝通先生的社会学经典著作。基于他在中国农村的实地调查和讲课内容整理而成。书中提出了“差序格局”、“礼治秩序”、“长老统治”、“无讼”等极具洞察力的概念，深刻剖析了中国传统基层社会的结构特征和运作逻辑。它是理解中国社会文化基因的必读之作，至今仍具有巨大的解释力。"
    },
    "围城": {
        "description": "钱钟书先生唯一的一部长篇小说，被誉为“现代儒林外史”。小说以留学生方鸿渐归国后的经历为主线，描绘了抗战初期知识分子的群像。作者以渊博的学识和幽默讽刺的语言，揭示了人生的困境：“城外的人想冲进去，城里的人想逃出来”。无论是婚姻、事业还是学问，都不过是一座座围城。"
    },
    "东方快车谋杀案": {
        "description": "阿加莎·克里斯蒂最著名的侦探小说之一。午夜过后，一场大雪迫使豪华的东方快车停了下来。第二天清晨，美国富商雷切特被发现死在包厢里，身中十二刀，而车门反锁。大侦探波洛在对车上十二名背景各异的乘客进行讯问后，揭开了一个令人震惊的真相。小说情节紧凑，逻辑严密，探讨了法律与正义的边界。"
    },
    "故事新编": {
        "description": "鲁迅的最后一部小说集。他取材于中国古代神话传说和历史故事，如《补天》、《奔月》、《理水》、《采薇》等，注入了现代意识和时代精神。鲁迅发挥了奇特的想象力，将庄严的古人写得滑稽幽默，在荒诞不经的描写中寄托了对现实的讽刺和批判，展现了他在文学形式上的大胆创新。"
    },
    "城南旧事": {
        "description": "林海音的自传体小说。通过六岁女孩英子的童稚视角，回忆了上世纪20年代北京城南的往事。书中讲述了疯女人秀贞、小偷那个人、乳母宋妈以及父亲的病逝等故事。淡淡的哀愁与浓浓的诗意交织，展现了老北京的风土人情和离别的感伤，“爸爸的花儿落了，我已不再是小孩子。”"
    },
    "万历十五年": {
        "description": "美籍华裔历史学家黄仁宇的成名作。书中选取了明朝万历十五年（1587年）这个看似平淡无奇的年份，考察了万历皇帝、申时行、张居正、海瑞、戚继光、李贽等六个人物。通过分析他们的命运，揭示了中国传统社会晚期在政治、道德、法律等方面的深层症结，提出了“大历史观”，对中国历史研究产生了深远影响。"
    },
    "秋园": {
        "description": "八旬奶奶杨本芬的处女作，讲述了母亲“秋园”及自己一家人在动荡年代的生存故事。秋园是一位普通的中国女性，在饥荒、战乱和贫穷中，凭借坚韧的生命力支撑起家庭。文字质朴无华，却充满了震撼人心的力量。这是一部关于苦难、尊严和爱的家族史，也是无数中国女性命运的缩影。"
    },
    "霍乱时期的爱情": {
        "description": "加西亚·马尔克斯仅次于《百年孤独》的经典巨著。讲述了弗洛伦蒂诺·阿里萨和费尔明娜·达萨跨越半个多世纪的爱情长跑。两人年轻时相爱却被迫分离，在各自经历了几十年的生活沧桑后，七十多岁的他们终于并在了一起。小说穷尽了爱情的各种可能性，被誉为“人类有史以来最伟大的爱情小说”。"
    },
    "艺术的故事": {
        "description": "贡布里希爵士的艺术史入门圣经。全书概括地叙述了从最早的洞窟绘画到当今的实验艺术的发展历程。作者用朴素晓畅的语言，清晰地阐述了艺术风格的演变及其背后的心理和文化原因。无需专业背景，读者也能从中领略艺术的魅力，理解“没有艺术这回事，只有艺术家”的深刻观点。"
    },
    "置身事内": {
        "description": "复旦大学经济学院教授兰小欢的力作。本书将经济学原理与中国经济发展的实践紧密结合，深入浅出地讲解了政府在经济发展中的角色和运作模式。从地方政府的土地财政、招商引资，到城市化、债务风险，全书条理清晰，数据详实，是理解中国政府行为和中国经济逻辑的极佳读本。"
    },
    "厌女": {
        "description": "日本著名社会学家上野千鹤子的代表作。运用女性主义理论，深刻剖析了当代文化中无处不在的“厌女症”（Misogyny）。作者指出，厌女症在男人身上表现为“女性蔑视”，在女人身上则表现为“自我厌恶”。书中对皇室、家庭、职场、性爱等领域的厌女现象进行了犀利批判，是女性自我觉醒的启蒙之书。"
    },
    "射雕英雄传": {
        "description": "金庸“射雕三部曲”的第一部，确立了金庸武侠宗师地位的经典之作。以南宋末年为背景，讲述了郭靖背负家仇国恨，在江湖历练中得遇黄蓉，并最终成长为“为国为民”的侠之大者的故事。小说气势恢宏，融合了历史、武侠、爱情、兵法等元素，塑造了东邪西毒南帝北丐中神通等经典人物。"
    },
    "月亮和六便士": {
        "description": "毛姆最著名的长篇小说之一。以法国印象派画家高更的生平为原型。讲述了英国证券交易所经纪人思特里克兰德，人到中年突然抛妻弃子，离家出走，只为了追求绘画的理想。他贫病交加，流落塔希提岛，最终创作出惊世杰作。小说探讨了理想与现实（月亮与六便士）的剧烈冲突，拷问了艺术与生活的代价。"
    },
    "西游记（全二册）": {
        "description": "中国古典四大名著之一，吴承恩所著的神魔小说。讲述了唐僧师徒四人西天取经的故事。一路上，孙悟空、猪八戒、沙僧辅佐师父，降妖伏魔，历经九九八十一难，终于取得真经。小说充满奇幻色彩，人物形象鲜明，孙悟空的叛逆与勇敢、猪八戒的贪吃与滑稽，深受世代读者喜爱，蕴含着深刻的人生哲理。"
    },
    "无人生还": {
        "description": "阿加莎·克里斯蒂最著名的作品之一，开创了“暴风雪山庄”模式。八个素不相识的人受邀来到海岛上的别墅，晚餐时留声机控诉了他们每个人隐藏的罪行。随后，客人们按照一首童谣的内容一个接一个地死去。在与世隔绝的孤岛上，谁是凶手？恐怖的氛围令人窒息。本书是推理文学史上难以逾越的高峰。"
    },
    "温柔的夜": {
        "description": "三毛的散文集，记录了她在加纳利群岛的生活点滴。在本书中，三毛的笔触依然细腻真诚，但相比撒哈拉时期的热烈，多了一份成熟与沉静。她写邻里间的琐事、旅途中的见闻、对他人的关怀以及对生活独特的感悟。篇章如《温柔的夜》、《拾荒梦》等，流淌着脉脉温情，展现了三毛对人间烟火的深情守望。"
    }
}

# 读取 mockData.ts
mockdata_path = Path("src/data/mockData.ts")
if not mockdata_path.exists():
    mockdata_path = Path("data/mockData.ts")

with open(mockdata_path, "r", encoding="utf-8") as f:
    content = f.read()

count = 0

def replace_desc(match, info, title):
    block = match.group(0)
    
    # 1. 替换或合并 description
    if 'description' in info:
        new_desc = info['description'].replace('"', '\\"').replace('\n', '\\n')
        # 查找现有的 description
        if re.search(r'["\']?description["\']?:', block):
             block = re.sub(r'(["\']?description["\']?:\s*)"(?:[^"\\]|\\.)*"', f'\\1"{new_desc}"', block, flags=re.DOTALL)
        else:
            # 如果没有，插入
             pass
            
    # 2. 替换或合并 authorDetail
    if 'authorDetail' in info:
         new_detail = info['authorDetail'].replace('"', '\\"').replace('\n', '\\n')
         if re.search(r'["\']?authorDetail["\']?:', block):
             block = re.sub(r'(["\']?authorDetail["\']?:\s*)"(?:[^"\\]|\\.)*"', f'\\1"{new_detail}"', block, flags=re.DOTALL)
         else:
             # 插入到 author 后面
             block = re.sub(r'((["\']?author["\']?:\s*".*?",))', f'\\1\n    authorDetail: "{new_detail}",', block)

    return block

# 更新循环
for title, info in book_info.items():
    # 使用稳健的正则
    pattern = rf'({{([^{{]*?)(?:["\']?title["\']?:\s*"{re.escape(title)}").*?}})'
    
    def replacer(match):
        return replace_desc(match, info, title)
        
    new_content, n = re.subn(pattern, replacer, content, flags=re.DOTALL)
    
    if n > 0:
        content = new_content
        count += 1
        print(f"✅ 更新: {title}")
    else:
        print(f"⚠️ 未找到: {title}")

# 写回文件
with open(mockdata_path, "w", encoding="utf-8") as f:
    f.write(content)

print(f"\n共更新 {count} 本书的信息")

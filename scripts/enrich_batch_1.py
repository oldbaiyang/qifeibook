#!/usr/bin/env python3
"""
自动补充缺失书籍信息 - 第一批 (缺失作者介绍 + 极短简介)
"""

import re
from pathlib import Path

# 这一批次主要针对：
# 1. 缺失 authorDetail 的书籍
# 2. description < 70 字的书籍

book_info = {
    # --- 缺失作者介绍 ---
    "明朝那些事儿(套装全7册)": {
        "authorDetail": "当年明月，本名石悦，湖北宜昌人。前政府公务员，中国最畅销的历史作家之一。他用现代幽默的语言风格讲述明朝历史，开创了“新历史小说”的先河。"
    },
    "膝盖之上": {
        "authorDetail": "小春多梦，网络小说作家，擅长细腻的情感描写和职场背景的现代言情故事，作品风格温暖治愈。"
    },
    "九诗心": {
        "authorDetail": "（此处若为特定版本或生僻书，尽量补充，若无则跳过）暂无详细介绍，待考证。"
    },
    "红楼梦": {
        "authorDetail": "曹雪芹，清代伟大的小说家。出身于“百年望族”的大官僚地主家庭，后家道中落。他以十年血泪，批阅十载，增删五次，创作了中国古典小说的巅峰之作《红楼梦》。"
    },
    "笑傲江湖（全四册）": {
        "authorDetail": "金庸，本名查良镛，浙江海宁人。当代武侠小说作家、新闻学家、企业家、政治评论家、社会活动家，“香港四大才子”之一。代表作有《射雕英雄传》、《神雕侠侣》、《倚天屠龙记》、《天龙八部》等。"
    },
    "太白金星有点烦": {
        "authorDetail": "马伯庸，著名作家。素有“文学鬼才”之称，擅长将历史与现代元素巧妙结合。代表作有《长安十二时辰》、《古董局中局》、《显微镜下的大明》等。"
    },
    "上帝掷骰子吗": {
        "authorDetail": "曹天元，科普作家。以“Capo”为笔名在网络论坛连载量子力学史话，后结集出版。他的笔触幽默风趣，将深奥的物理学理论讲述得通俗易懂，深受读者喜爱。"
    },
    "人间词话": {
        "authorDetail": "王国维，中国近现代著名的学者、国学大师。他在文学、美学、史学、哲学等领域均有深厚造诣。其《人间词话》是将被誉为中国古典文学批评的里程碑之作。"
    },
    "遥远的向日葵地": {
        "authorDetail": "李娟，作家。长期居住在新疆阿勒泰地区，其文字明净、质朴，充满灵性，真实展现了哈萨克游牧民族的生活风貌。被誉为“阿勒泰的精灵”。",
        "description": "本书是李娟的非虚构散文代表作。她记录了母亲在乌伦古河南岸种植向日葵的艰辛历程。在这片贫瘠、荒凉甚至残酷的土地上，向日葵金色的花盘成为生存的希望与尊严的象征。李娟以细腻的笔触，书写了人与自然、人与命运的抗争与和解，文字间流淌着动人的温情与坚韧的力量。"
    },
    "面纱": {
        "authorDetail": "W.S.毛姆（William Somerset Maugham），英国现代著名小说家、剧作家。他的作品常以冷静、讽刺的笔调揭示人性的复杂与虚伪。代表作有《月亮和六便士》、《由于人生的枷锁》等。"
    },
    "倚天屠龙记": {
        "authorDetail": "金庸，武侠小说泰斗。本书是“射雕三部曲”的终章，以元末群雄纷起、江湖动荡为背景，讲述了张无忌的成长历程以及江湖上的恩怨情仇。"
    },
    "一千零一夜": {
        "authorDetail": "阿拉伯民间故事集，又名《天方夜谭》。由古代阿拉伯、波斯、印度等地的民间传说经过几个世纪的演变和加工而成，是世界文学殿堂中的瑰宝。"
    },
    "雨季不再来": {
        "authorDetail": "三毛，台湾著名女作家。本书记录了她17岁到22岁的成长历程，包含她在二毛时期的生活点滴和在西班牙求学的经历，展现了一个敏感、叛逆少女的蜕变。",
        "description": "《雨季不再来》是三毛的散文集，收录了她早期的作品。也就是她自称为“二毛”时期的文字。如果说《撒哈拉的故事》是三毛流浪文学的代表，那么这本书则是她青涩岁月的见证。书中记录了她从一个敏感、自闭、叛逆的少女，逐渐走出阴霾，并在异国他乡的历练中变得坚强、开朗的过程。那个潮湿迷惘的“雨季”终将过去，迎来的是明媚的阳光。"
    },
    "最好的我们": {
        "authorDetail": "八月长安，青年作家，编剧。毕业于北京大学光华管理学院。代表作“振华三部曲”：《你好，旧时光》、《暗恋·橘生淮南》、《最好的我们》。"
    },
    "康熙的红票": {
        "authorDetail": "孙立群，历史学者。本书通过一张清代康熙年间的“红票”（信物），钩沉出一段鲜为人知的中西文化交流往事，展现了康熙时代中国与世界的互动。",
        "description": "《康熙的红票》从一张康熙年间发给梵蒂冈教皇的信函（红票）入手，抽丝剥茧，讲述了清初天主教传教士在中国的活动以及礼仪之争的始末。作者以微观史学的视角，通过大量详实的史料，展现了康熙皇帝的雄才大略以及当时中国与西方世界在宗教、科学、文化等方面的碰撞与交流，是一部兼具学术深度和阅读趣味的历史著作。"
    },
    "送你一颗子弹": {
        "authorDetail": "刘瑜，清华大学政治学系副教授，作家。她的文字犀利、幽默、理性，善于通过生活琐事探讨社会、政治与人性。代表作还有《民主的细节》。"
    },
    "坟": {
        "authorDetail": "鲁迅，中国现代文学的奠基人。本书是鲁迅的第一本杂文集，收录了他1907年至1925年间创作的论文和杂感，记录了他早期的思想轨迹和战斗历程。"
    },
    "孩子你慢慢来": {
        "authorDetail": "龙应台，台湾著名作家、学者。本书是她作为母亲的育儿手记，以温柔、宽容的笔触，记录了陪伴孩子成长的点滴感悟，流露出深沉的母爱。",
        "description": "《孩子你慢慢来》是龙应台“人生三书”之一。作为一位母亲，龙应台在书中没有宏大的叙事，只有对孩子生活细节的深情注视。她看着孩子从婴儿到幼儿，用笨拙的动作探索世界，用稚嫩的语言表达想法。她愿意用一生的耐心去等待孩子，让他慢慢地长，慢慢地认识这个世界。这本书让无数父母在忙碌与焦虑中停下脚步，重新审视亲子关系，感受生命成长的从容与美好。"
    },
    "九州缥缈录": {
        "authorDetail": "江南，中国幻想文学代表作家。本书是其代表作“九州”系列的各种核心作品，构建了一个庞大而严谨的东方奇幻世界，讲述了乱世英雄的成长史。"
    },
    "显微镜下的大明": {
        "authorDetail": "马伯庸，作家。本书从明代档案中的六个基层政治事件入手，通过细腻的笔触，还原了明代平民的真实政治生活，展现了底层社会的运行逻辑。"
    },
    "金锁记": {
        "authorDetail": "张爱玲，中国现代著名女作家。她的小说多描写没落贵族家庭和都市男女的爱恨纠葛，语言苍凉细腻，意象独特。傅雷曾盛赞《金锁记》是“我们文坛最美的收获”。"
    },
    "野火集": {
        "authorDetail": "龙应台，作家、评论家。1985年《野火集》甫一出版，便如野火燎原般席卷台湾，她以犀利的笔锋批判社会乱象，唤醒了公民意识，震动了整个华人世界。"
    },
    "你好旧时光": {
        "authorDetail": "八月长安，作家。本书是“振华三部曲”的第一部，以余周周的成长为主线，展现了80后、90后一代人的青春记忆，被誉为全景式青春治愈力作。"
    },
    "胎记": {
        "authorDetail": "纳撒尼尔·霍桑，19世纪美国浪漫主义文学巨匠。他的作品多探讨罪恶、道德和人性，充满神秘色彩和象征主义手法。代表作有《红字》。"
    },
    "三国战争与地要天时": {
        "authorDetail": "宋杰，首都师范大学历史学院教授，博士生导师。长期从事秦汉魏晋南北朝史和历史地理研究。著有《中国古代战争的地理枢纽》等。",
        "description": "本书从军事地理和气候气象的独特视角，重新解读了三国时期的经典战役。作者深入分析了地形、水文、气候等自然地理因素如何影响将领的决策和战争的走向，如赤壁之风、夷陵之火、街亭之险等。通过详实的史料考证，揭示了“天时地利”在冷兵器时代战争中的决定性作用，为读者理解三国历史提供了全新的维度。"
    },
    "午后进入我房间": {
        "authorDetail": "李洱，中国当代著名作家。其作品风格深沉、幽默，善于描绘知识分子的精神状态。代表作有《花腔》、《石榴树上结樱桃》等。"
    },
    
    # --- 简介极短 (< 70 字) ---
    "三分钟趣读中国史从战国到西汉": {
        "description": "本书以幽默风趣、通俗易懂的语言，梳理了从战国七雄争霸到西汉王朝建立与兴盛的历史脉络。作者抛弃了枯燥的史料堆砌，通过一个个生动有趣的小故事，将复杂的历史事件和人物关系讲得清晰明了。即使是历史小白，也能在三分钟内轻松读懂一段历史，是极佳的历史入门读物。"
    },
    "两魏周齐战争中的河东": {
        "description": "本书是关于北朝后期西魏（北周）与东魏（北齐）之间战争的军事地理研究专著。河东地区（今山西南部）作为双方争夺的战略枢纽，见证了无数次血腥的拉锯战。作者通过对河东山川地势的考证，分析了双方的攻防策略、进军路线以及在此发生的历次战役，深入揭示了河东战场对于北朝此时期历史进程的关键影响。"
    },
    "江户时代江户城": {
        "description": "本书详细考证了日本江户时代（1603-1867）幕府所在地江户城（今东京）的城市布局、建筑结构以及在此生活的各阶层人民的状态。从将军的御所到武士的屋敷，再到平民的长屋，作者利用丰富的图文资料，复原了这座当时世界上最大城市的繁华景象，展现了江户时代的社会风貌与文化特色。",
        "authorDetail": "日本历史研究学者。" 
    },
    "三国史 – 马植杰": {
        "description": "马植杰先生是著名的三国史专家，本书是其毕生心血的结晶。全书引用史料宏富，考证精详，对三国时期的政治、军事、经济、文化以及重要人物进行了全面而系统的论述。不同于演义故事，本书力求还原历史真貌，对许多历史谜团提出了独到的见解，是研读三国正史不可多得的参考著作。",
        "authorDetail": "马植杰，著名历史学家，在魏晋南北朝史领域造诣深厚。"
    },
    "信仰": {
        "description": "本书围绕“信仰”这一核心主题，探讨了人类精神世界中的终极追求。无论是宗教信仰、政治信仰还是对真理、科学的信仰，都是支撑人类文明前行的重要力量。作者通过对不同历史时期、不同文化背景下信仰形式的考察，揭示了信仰如何塑造个人命运以及如何影响历史进程，引导读者思考生命的意义。",
         "authorDetail": "具体作者不详，待确认版本。"
    },
    "1984": {
        "description": "《1984》是乔治·奥威尔创作的反乌托邦小说经典，与《美丽新世界》、《我们》并称为“反乌托邦三部曲”。小说描绘了一个被极权主义监控的未来社会，真理部篡改历史，友爱部实施严刑，思想警察无处不在，“老大哥”在看着你。奥威尔以惊人的预见力，警示了极权统治对人性、自由和真理的毁灭，是20世纪影响最为深远的政治寓言。",
         "authorDetail": "乔治·奥威尔，英国伟大作家。"
    },
    "解忧杂货店": {
        "description": "《解忧杂货店》是东野圭吾风格迥异的一部奇幻温情小说。在僻静的街道旁，有一家杂货店，只要把烦恼写在信里投进卷帘门的投信口，第二天就会在店后的牛奶箱里得到回答。三个小偷误闯进这间废弃的店，意外收到了来自过去的咨询信。他们开始提笔回信，连接起了过去与未来的时空，也在治愈他人的过程中找到了自己的人生方向。",
         "authorDetail": "东野圭吾，日本畅销书作家，推理小说天王。"
    },
    "寻路中国": {
        "description": "《寻路中国》是美国作家彼得·海斯勒（何伟）的中国纪实三部曲之一。作者驾车漫游中国，从长城脚下的农村到新兴的工业城镇，深入中国社会的肌理。他以敏锐的观察和客观的笔触，记录了中国普通人在现代化进程中的变迁、挣扎与希望，展现了一个真实、复杂而充满活力的中国。",
         "authorDetail": "彼得·海斯勒（Peter Hessler），中文名何伟，曾任《纽约客》驻华记者，以纪实写作闻名。"
    },
    "告白": {
        "description": "《告白》是日本作家凑佳苗的成名作，也是一部令人寒毛直竖的“致郁系”推理小说。故事从森口老师在讲台上的一段“告白”开始：她年幼的女儿被班上的学生杀害了。森口老师没有选择报警，而是展开了一场冷静而疯狂的复仇。小说通过不同角色的内心独白，层层揭开案件背后的真相，直面青少年犯罪、校园霸凌以及家庭教育的黑暗面。",
        "authorDetail": "凑佳苗，日本推理小说家，被称为“致郁系”女王。"
    },
    "别让微压力消耗你": {
        "description": "在现代生活中，我们常被各种看似微不足道的压力所包围：没完没了的消息通知、人际关系的微妙摩擦、对未来的隐隐担忧……这些“微压力”虽然不会瞬间击垮我们，但会像慢性毒药一样持续消耗我们的精力与健康。本书深入剖析了微压力的来源与机制，并提供了科学实用的应对策略，帮助读者重建心理韧性，重获生活的掌控感。",
        "authorDetail": "罗伯·克洛斯等，心理学与组织行为学专家。"
    }
}

# 读取 mockData.ts
mockdata_path = Path("src/data/mockData.ts")
if not mockdata_path.exists():
    mockdata_path = Path("data/mockData.ts")

with open(mockdata_path, "r", encoding="utf-8") as f:
    content = f.read()

count = 0

def replace_desc(match, info, title):
    block = match.group(0)
    
    # 1. 替换或合并 description
    if 'description' in info:
        new_desc = info['description'].replace('"', '\\"').replace('\n', '\\n')
        # 查找现有的 description
        if re.search(r'["\']?description["\']?:', block):
             block = re.sub(r'(["\']?description["\']?:\s*)"(?:[^"\\]|\\.)*"', f'\\1"{new_desc}"', block, flags=re.DOTALL)
        else:
            # 如果没有(很少见), 插入
            pass
            
    # 2. 替换或合并 authorDetail
    if 'authorDetail' in info:
         new_detail = info['authorDetail'].replace('"', '\\"').replace('\n', '\\n')
         if re.search(r'["\']?authorDetail["\']?:', block):
             block = re.sub(r'(["\']?authorDetail["\']?:\s*)"(?:[^"\\]|\\.)*"', f'\\1"{new_detail}"', block, flags=re.DOTALL)
         else:
             # 插入到 author 后面
             block = re.sub(r'((["\']?author["\']?:\s*".*?",))', f'\\1\n    authorDetail: "{new_detail}",', block)

    return block

# 更新循环
for title, info in book_info.items():
    # 使用稳健的正则 (同上一个脚本)
    pattern = rf'({{([^{{]*?)(?:["\']?title["\']?:\s*"{re.escape(title)}").*?}})'
    
    # 使用闭包传递额外参数
    def replacer(match):
        return replace_desc(match, info, title)
        
    new_content, n = re.subn(pattern, replacer, content, flags=re.DOTALL)
    
    if n > 0:
        content = new_content
        count += 1
        print(f"✅ 更新: {title}")
    else:
        print(f"⚠️ 未找到: {title}")

# 写回文件
with open(mockdata_path, "w", encoding="utf-8") as f:
    f.write(content)

print(f"\n共更新 {count} 本书的信息")

#!/usr/bin/env python3
"""
修复元数据错位问题
"""
import re
from pathlib import Path

# 正确的书籍数据
book_info = {
    "新名字的故事": {
        "author": "[意] 埃莱娜·费兰特",
        "authorDetail": "埃莱娜·费兰特,意大利当代匿名作家,'那不勒斯四部曲'作者",
        "description": "《新名字的故事》是'那不勒斯四部曲'的第二部,描述了莉拉和埃莱娜的青年时代。在她们的人生中,痛苦和幸福、愤怒和压抑、希望和绝望依然紧紧交织。她们在各自的生活中努力挣扎,试图找到属于自己的位置。",
        "year": "2012"
    },
    "杀死一只知更鸟": {
        "author": "[美] 哈珀·李",
        "authorDetail": "哈珀·李,美国作家,普利策小说奖得主",
        "description": "《杀死一只知更鸟》讲述了20世纪30年代美国南方一个小镇上,律师阿提克斯为一名被指控强奸白人女子的黑人辩护的故事。小说通过两个孩子的视角,展现了种族偏见、社会不公以及成长的阵痛,是一部感人至深的经典之作。",
        "year": "1960"
    },
    "野草": {
        "author": "鲁迅",
        "authorDetail": "鲁迅,中国现代文学奠基人",
        "description": "《野草》是鲁迅先生唯一的一部散文诗集,收录了他在1924年至1926年间创作的23篇散文诗。作品以隐晦的象征、富于诗意的意象和充满张力的语言,表达了作者对现实的绝望、抗争以及对生命意义的深刻思考。",
        "year": "1927"
    },
    "沉默的大多数": {
        "author": "王小波",
        "authorDetail": "王小波,中国当代著名学者、作家",
        "description": "《沉默的大多数》是王小波的一部杂文随笔集。作者以幽默智慧的笔触,对社会现象、文化传统、人性心理等进行了深入的剖析和批判,倡导自由、理性、独立的思考精神。",
        "year": "1997"
    },
    "罗杰疑案": {
        "author": "[英] 阿加莎·克里斯蒂",
        "authorDetail": "阿加莎·克里斯蒂,英国侦探小说女王",
        "description": "《罗杰疑案》是阿加莎·克里斯蒂的成名作,也是侦探小说史上的经典之作。小说讲述了住在金艾博特村的富翁罗杰·艾克罗伊德离奇身亡,大侦探波洛介入调查的故事。结局出人意料,开创了侦探小说的一种全新模式。",
        "year": "1926"
    },
    "悉达多": {
        "author": "[德] 赫尔曼·黑塞",
        "authorDetail": "赫尔曼·黑塞,德国作家,诺贝尔文学奖得主",
        "description": "《悉达多》讲述了古印度贵族青年悉达多为了追求心灵的安宁和生命的真谛,离家出走,历经各种人生体验,最终在流水的启示下悟道的故事。这是一部关于自我发现和精神成长的寓言。",
        "year": "1922"
    },
    "我与地坛": {
        "author": "史铁生",
        "authorDetail": "史铁生,中国当代著名作家",
        "description": "《我与地坛》是史铁生的散文代表作。作者身患残疾,在最狂妄的年龄失去了双腿。他在地坛的古园中沉思冥想,对生命、死亡、命运等终极问题进行了深刻的感悟。文字深沉凝重,感人肺腑。",
        "year": "1991"
    },
    "许三观卖血记": {
        "author": "余华",
        "authorDetail": "余华,中国当代先锋文学代表作家",
        "description": "《许三观卖血记》讲述了丝厂送茧工许三观靠卖血度过人生一个个难关的故事。小说以卖血为主线,串联起许三观的一生,展现了小人物在苦难生活中的生存智慧和顽强生命力。",
        "year": "1995"
    },
    "彷徨": {
        "author": "鲁迅",
        "authorDetail": "鲁迅,中国现代文学奠基人",
        "description": "《彷徨》是鲁迅的第二部小说集,收录了他在1924年至1925年间创作的11篇小说,包括《祝福》《在酒楼上》《伤逝》等。作品反映了五四运动后知识分子的苦闷和彷徨,以及对社会现实的深刻批判。",
        "year": "1926"
    },
    "局外人": {
        "author": "[法] 阿尔贝·加缪",
        "authorDetail": "阿尔贝·加缪,法国作家、哲学家,存在主义文学代表人物,诺贝尔文学奖得主",
        "description": "《局外人》是加缪的成名作。小说塑造了默尔索这个'局外人'形象,他对母亲的死、女友的感情、杀人等都表现得冷漠无动于衷。小说揭示了世界的荒诞性以及人与社会的疏离。",
        "year": "1942"
    },
    "白鹿原": {
        "author": "陈忠实",
        "authorDetail": "陈忠实,中国当代著名作家,茅盾文学奖得主",
        "description": "《白鹿原》是一部渭河平原50年变迁的雄奇史诗,一轴中国农村斑斓多彩、触目惊心的长幅画卷。小说以白嘉轩为叙事核心,描写了白鹿两家三代人的恩怨纠葛,展现了从清末民初到建国之初中国农村的历史演变。",
        "year": "1993"
    },
    "乡土中国": {
        "author": "费孝通",
        "authorDetail": "费孝通,中国著名社会学家、人类学家",
        "description": "《乡土中国》是费孝通先生的一部社会学经典著作。书中探讨了中国基层传统社会结构及其运作逻辑,提出了'差序格局'、'礼治秩序'、'无讼'等重要概念,深刻剖析了中国乡土社会的特点。",
        "year": "1947"
    },
    "平凡的世界（全三部）": {
        "author": "路遥",
        "authorDetail": "路遥,中国当代作家,茅盾文学奖得主",
        "description": "《平凡的世界》是一部全景式地表现中国当代城乡社会生活的长篇小说。小说以孙少安和孙少平两兄弟为中心,刻画了当时社会各阶层众多普通人的形象;劳动与爱情、挫折与追求、痛苦与欢乐、日常生活与巨大社会冲突纷繁地交织在一起,深刻地展示了普通人在大时代历史进程中所走过的艰难曲折的道路。",
        "year": "1986"
    },
    "人类简史": {
        "author": "[以] 尤瓦尔·赫拉利",
        "authorDetail": "尤瓦尔·赫拉利,以色列历史学家",
        "description": "《人类简史:从动物到上帝》从大历史的视角,审视了人类历史上的三次革命:认知革命、农业革命和科学革命。作者以新颖的观点和宏大的视野,探讨了人类如何从一种不起眼的动物演变为地球的主宰,以及人类社会的未来走向。",
        "year": "2011"
    },
    "围城": {
        "author": "钱钟书",
        "authorDetail": "钱钟书,中国现代著名学者、作家",
        "description": "《围城》是钱钟书先生唯一的一部长篇小说,被誉为'新儒林外史'。小说以方鸿渐的经历为主线,描绘了抗战初期知识分子的群像,揭示了'围城'困境:城外的人想冲进去,城里的人想逃出来。",
        "year": "1947"
    },
    "笑傲江湖（全四册）": {
        "author": "金庸",
        "authorDetail": "金庸,武侠小说泰斗",
        "description": "《笑傲江湖》属于金庸的后期作品。小说通过叙述华山派大弟子令狐冲的经历,反映了武林各派争霸夺权的血腥斗争,揭露了伪君子和野心家的丑恶面目,歌颂了令狐冲追求自由、不畏强权的独立人格。",
        "year": "1967"
    },
    "献给阿尔吉侬的花束": {
        "author": "[美] 丹尼尔·凯斯",
        "authorDetail": "丹尼尔·凯斯,美国作家,心理学家",
        "description": "查理·高登是低智商者,他参加了一项提高智力的实验手术。手术后,他的智商逐渐提高,变成了一个天才。然而,他发现原本的朋友和同事开始排斥他,他也发现了社会中隐藏的残酷真相。同时,同样接受手术的实验白鼠阿尔吉侬出现了退化现象,预示着查理的命运......",
        "year": "1959"
    },
    "东方快车谋杀案": {
        "author": "[英] 阿加莎·克里斯蒂",
        "authorDetail": "阿加莎·克里斯蒂,侦探小说女王",
        "description": "午夜过后,一场大雪迫使东方快车停了下来。侦探波洛在列车上。第二天早上,大家发现萨缪埃尔·雷切特死在了他的包厢里,身中十二刀。车上的乘客都有嫌疑,波洛展开了调查,最终揭开了一个惊人的秘密。",
        "year": "1934"
    },
    "故事新编": {
        "author": "鲁迅",
        "authorDetail": "鲁迅,中国现代文学奠基人",
        "description": "《故事新编》是鲁迅的最后一部小说集,收录了他在1922年至1935年间创作的8篇历史小说。作者以远古神话和历史传说为题材,注入现代意识,进行了大胆的改编和重构,充满了奇特的想象和辛辣的讽刺。",
        "year": "1936"
    }
}

mockdata_path = Path("src/data/mockData.js")
with open(mockdata_path, "r", encoding="utf-8") as f:
    content = f.read()

count = 0
for title, info in book_info.items():
    # 使用严格匹配，只替换紧跟在 title 后的字段
    # 匹配: title: "书名", (换行 空格) author: "..." (换行 空格) authorDetail: "..."
    
    # 1. 替换 Author
    pattern_author = rf'(title: "{re.escape(title)}"[^}}]+?author:\s*)"[^"]*"'
    content = re.sub(pattern_author, rf'\1"{info["author"]}"', content, count=1)
    
    # 2. 替换 AuthorDetail
    pattern_detail = rf'(title: "{re.escape(title)}"[^}}]+?authorDetail:\s*)"[^"]*"'
    content = re.sub(pattern_detail, rf'\1"{info["authorDetail"]}"', content, count=1)
    
    # 3. 替换 Year
    pattern_year = rf'(title: "{re.escape(title)}"[^}}]+?year:\s*)"[^"]*"'
    content = re.sub(pattern_year, rf'\1"{info["year"]}"', content, count=1)
    
    # 4. 替换 Description
    desc = info['description'].replace('"', '\\"').replace('\n', ' ')
    pattern_desc = rf'(title: "{re.escape(title)}"[^}}]+?description:\s*)"[^"]*"'
    content = re.sub(pattern_desc, rf'\1"{desc}"', content, count=1)
    
    print(f"✓ 已修复: {title}")
    count += 1

with open(mockdata_path, "w", encoding="utf-8") as f:
    f.write(content)

print(f"\n✅ 成功修复 {count} 本书的元数据")

#!/usr/bin/env python3
"""
自动补充书籍信息
读取 filtered_books.json，补充作者、简介等信息，输出 enriched_books.json
"""

import json
from pathlib import Path

# 知识库：书名 -> 详情
# 这里的 key 必须与 filtered_books.json 中的 title 完全匹配
KNOWLEDGE_BASE = {
    "流俗地": {
        "author": "黎紫书",
        "authorDetail": "黎紫书，马来西亚华语文学代表作家。",
        "year": "2020",
        "category": "小说文学",
        "description": "《流俗地》以马来西亚锡都的一栋组屋为背景，讲述了盲女银霞及其邻居、朋友们的命运沉浮。小说通过细腻的笔触，描绘了市井小民在时代变迁中的喜怒哀乐，展现了一幅充满烟火气的南洋生活画卷。"
    },
    "上帝掷骰子吗": {
        "author": "曹天元",
        "authorDetail": "曹天元，科普作家。",
        "year": "2006",
        "category": "人文社科",
        "description": "《上帝掷骰子吗：量子物理史话》是一部风靡华人世界的科普神作。作者以通俗幽默的语言，回顾了量子论从诞生到发展的百年历史，将那些枯燥的物理理论变成了扣人心弦的故事，带领读者走进神秘的微观世界。"
    },
    "窗边的小豆豆": {
        "author": "[日] 黑柳彻子",
        "authorDetail": "黑柳彻子，日本著名作家、主持人。",
        "year": "1981",
        "category": "学习教育",
        "description": "《窗边的小豆豆》讲述了作者上小学时的一段真实故事。小豆豆因淘气被原学校退学后，来到巴学园。在小林校长的爱护和引导下，一般人眼里“怪怪”的小豆豆逐渐变成了一个大家都能接受的孩子，并奠定了她一生的基础。"
    },
    "最好的告别": {
        "author": "[美] 阿图·葛文德",
        "authorDetail": "阿图·葛文德，白宫最年轻的健康政策顾问，外科医生。",
        "year": "2014",
        "category": "生活时尚",
        "description": "《最好的告别：关于衰老与死亡，你必须知道的常识》探讨了衰老与死亡这一每个人都无法回避的话题。作者通过讲述一个个感人至深的故事，提出了在现代医学条件下，如何让人们优雅地跨越生命的终点，如何自主地掌控生命的最后阶段。"
    },
    "筚路维艰": {
        "author": "萧冬连",
        "authorDetail": "萧冬连，中国当代史研究学者。",
        "year": "2014",
        "category": "历史传记",
        "description": "《筚路维艰：中国社会主义路径的五次选择》清晰地梳理了当代中国的发展逻辑。作者回顾了从建国初期到改革开放的历史进程，分析了中国在不同时期所面临的挑战和做出的关键抉择，有助于读者深刻理解当代中国的历史命运。"
    },
    "哭泣的骆驼": {
        "author": "三毛",
        "authorDetail": "三毛，台湾著名女作家。",
        "year": "1977",
        "category": "小说文学",
        "description": "《哭泣的骆驼》是三毛在撒哈拉沙漠生活经历的延续。书中记录了她在沙漠中见证的动荡局势和悲剧故事，特别是《哭泣的骆驼》一篇，描写了沙伊达和巴西里悲壮的爱情与牺牲，充满了对生命和人性的悲悯。"
    },
    "冬牧场": {
        "author": "李娟",
        "authorDetail": "李娟，当代散文家，以新疆阿勒泰题材写作闻名。",
        "year": "2012",
        "category": "小说文学",
        "description": "《冬牧场》记录了李娟跟随一家哈萨克牧民深入阿勒泰南部的沙漠冬牧场度过一个冬天的经历。她以灵动幽默的笔触，描绘了在荒凉贫瘠的环境中，人们如何以坚韧和智慧，把日子过得生机勃勃、充满尊严。"
    },
    "呼兰河传": {
        "author": "萧红",
        "authorDetail": "萧红，中国近现代女作家，“民国四大才女”之一。",
        "year": "1940",
        "category": "小说文学",
        "description": "《呼兰河传》是萧红的代表作，是一部回忆性长篇小说。作者以童年的视角，回忆了家乡呼兰河城的风土人情和那些平凡而又悲苦的小人物，如团圆媳妇、有二伯、冯歪嘴子等，展现了旧中国北方小城的荒凉与寂寞。"
    },
    "棋王·树王·孩子王": {
        "author": "阿城",
        "authorDetail": "阿城，当代著名作家、编剧。",
        "year": "1984",
        "category": "小说文学",
        "description": "本书收录了阿城的三个中篇小说代表作。《棋王》通过“棋呆子”王一生的故事，表现了传统文化对精神的滋养；《树王》探讨了人与自然的关系；《孩子王》则反思了教育与文化的传承。语言精炼，意蕴深远。"
    },
    "罪与罚": {
        "author": "[俄] 陀思妥耶夫斯基",
        "authorDetail": "陀思妥耶夫斯基，俄国文学巨匠。",
        "year": "1866",
        "category": "小说文学",
        "description": "《罪与罚》是世界文学史上的经典之作。穷大学生拉斯柯尔尼科夫为了证明自己是“超人”，杀死了放高利贷的老太婆。然而，犯罪后的恐惧和良心的折磨使他痛苦不堪。在索尼娅的感召下，他最终投案自首，踏上了赎罪与新生的道路。"
    },
    "离开的，留下的": {
        "author": "[意] 埃莱娜·费兰特",
        "authorDetail": "埃莱娜·费兰特，意大利著名作家。",
        "year": "2013",
        "category": "小说文学",
        "description": "《离开的，留下的》是“那不勒斯四部曲”的第三部。莉拉和埃莱娜已经长大成人，并在各自的生活中面临新的挑战。埃莱娜出版了小说，进入了上层文化圈；莉拉则在工厂做苦工，参与工人运动。两人在动荡的社会环境中，继续着她们复杂的友谊。"
    },
    "明亮的夜晚": {
        "author": "[韩] 崔恩荣",
        "authorDetail": "崔恩荣，韩国新生代代表作家。",
        "year": "2021",
        "category": "小说文学",
        "description": "《明亮的夜晚》讲述了“我”在离婚后回到祖母故乡，意外重逢多年未见的祖母，并聆听了曾祖母、祖母、母亲及“我”四代女性的故事。小说以温柔的笔触，串联起百年的时间长河，抚慰了女性代际间的心灵创伤。"
    },
    "人间词话": {
        "author": "王国维",
        "authorDetail": "王国维，国学大师。",
        "year": "1908",
        "category": "人文社科",
        "description": "《人间词话》是中国近代最负盛名的词话著作。王国维在书中提出了著名的“境界”说，以西方美学思想观照中国古典文学，对历代词人和词作进行了精彩的点评，是学习中国诗词美学的必读之作。"
    },
    "叫魂": {
        "author": "[美] 孔飞力",
        "authorDetail": "孔飞力，美国著名汉学家。",
        "year": "1990",
        "category": "历史传记",
        "description": "《叫魂：1768年中国妖术大恐慌》讲述了清朝乾隆年间发生的一场关于“叫魂”妖术的社会大恐慌。作者通过对这一事件的层层剖析，揭示了传统中国政治权力的运作逻辑、官僚体制的弊端以及底层社会的生存状态。"
    },
    "西线无战事": {
        "author": "[德] 埃里希·玛利亚·雷马克",
        "authorDetail": "雷马克，德裔美籍作家。",
        "year": "1929",
        "category": "小说文学",
        "description": "《西线无战事》是反战文学的经典之作。小说以第一次世界大战为背景，通过一名年轻士兵的视角，描写了战争的残酷、恐怖和对人性的摧残，控诉了战争的罪恶，发出了对和平的呼唤。"
    },
    "道德经": {
        "author": "[周] 老子",
        "authorDetail": "老子，道家学派创始人。",
        "year": "春秋",
        "category": "人文社科",
        "description": "《道德经》是道家哲学的奠基之作，也是中国历史上最伟大的著作之一。全书仅五千言，却蕴含了关于宇宙、自然、社会、人生等方面的深刻智慧，提出了“道法自然”、“无为而治”等核心思想。"
    },
    "也许你该找个人聊聊": {
        "author": "[美] 洛里·戈特利布",
        "authorDetail": "洛里·戈特利布，心理治疗师，畅销书作家。",
        "year": "2019",
        "category": "生活时尚",
        "description": "本书的作者是一位心理治疗师，她在书中双线讲述了自己作为治疗师帮助病人的故事，以及自己作为病人向另一位治疗师寻求帮助的经历。通过一个个真实鲜活的案例，展示了心理治疗的治愈力量，以及我们在面对痛苦、爱与失去时的人性。"
    },
    "平面国": {
        "author": "[英] 埃德温·A·艾勃特",
        "authorDetail": "埃德温·A·艾勃特，英国神学家、小说家。",
        "year": "1884",
        "category": "科幻小说",
        "description": "《平面国》是一部奇妙的科幻与数学寓言。故事发生在一个二维的平面世界里，居民们都是各种几何图形。通过平面国人对一维国和三维国的探索，作者以幽默讽刺的笔调，探讨了维度的概念，并影射了维多利亚时代的社会阶级与偏见。"
    },
    "文学回忆录": {
        "author": "木心",
        "authorDetail": "木心，中国当代画家、作家。",
        "year": "2013",
        "category": "人文艺术",
        "description": "《文学回忆录》是木心在纽约为陈丹青等艺术家讲授世界文学史的笔录。木心以其独特的艺术视角和才情，评点古今中外的文学巨匠和经典名著，妙语连珠，见解独到，是一部充满个人风格的文学史。"
    },
    "遥远的向日葵地": {
        "author": "李娟",
        "authorDetail": "李娟，当代散文家。",
        "year": "2017",
        "category": "小说文学",
        "description": "《遥远的向日葵地》是李娟的非虚构代表作。书中记录了她和母亲、外婆在阿勒泰乌伦古河南岸种植向日葵的艰辛历程。作者以细腻深情的文字，刻画了母亲坚韧乐观的形象，赞美了大地上顽强的生命力。"
    }
}

def main():
    print("开始补充书籍信息...")
    input_path = Path("filtered_books.json")
    output_path = Path("enriched_books.json")
    
    if not input_path.exists():
        print(f"Error: {input_path} 不存在")
        return

    with open(input_path, "r", encoding="utf-8") as f:
        books = json.load(f)

    enriched_count = 0
    for book in books:
        title = book['title']
        # 简单清洗标题，去除可能的空格
        clean_title = title.strip()
        
        if clean_title in KNOWLEDGE_BASE:
            info = KNOWLEDGE_BASE[clean_title]
            book.update(info)
            enriched_count += 1
            print(f"✓ 已补充: {clean_title}")
        else:
            print(f"⚠ 未找到信息: {clean_title} (使用默认值)")
            # 也可以设置一些默认值，防止下游脚本显示 '待补充'
            if 'author' not in book: book['author'] = "待补充"
            if 'description' not in book: book['description'] = title

    with open(output_path, "w", encoding="utf-8") as f:
        json.dump(books, f, ensure_ascii=False, indent=2)

    print(f"\n完成！已补充 {enriched_count}/{len(books)} 本书。保存至 {output_path}")

if __name__ == "__main__":
    main()
